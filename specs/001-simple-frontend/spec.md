# 機能仕様: 一問フロントエンド（麻雀手牌クイズ）

**フィーチャーブランチ**: `001-simple-frontend`  
**作成日**: 2025-02-28  
**ステータス**: ドラフト  
**入力**: 「一問フロントエンドで表示する。トップページのボタンで出題画面、バックエンドのtilesと画像を萬索筒字の順で表示、解答は全種類の牌を複数選択可能、解答ボタンでwinningTiles一致時は正解・不一致時は不正解をモーダル表示。」

## Clarifications

### Session 2025-02-28

- Q: 1枚も選択せずに「解答する」を押した場合の挙動は？（送信無効 / 不正解扱い / その他） → A: 解答するボタンを無効化する（1枚以上選択するまで押せない）
- Q: 牌コードに対応する画像ファイルが存在しない場合の扱いは？ → A: 該当牌のみエラー表示（例: 画像枠＋「読み込み失敗」）とし、他は表示して続行可能にする
- Q: 結果モーダルを閉じた後の遷移先は？ → A: 出題画面のまま留まり、同じ問題をやり直し or 戻るボタンでトップへ
- Q: バックエンドがデータを返さない／エラーを返した場合の挙動は？ → A: エラーメッセージ＋リトライとトップへ戻るの両方を用意する

## ユーザーシナリオとテスト *(必須)*

### ユーザーストーリー1 - クイズを開始する (優先度: P1)

ユーザーはトップページにおり、クイズの出題を見たい状態である。ボタンをクリックして出題画面を開く。システムは出題データを取得し、手牌（牌）と解答選択エリアを表示する。

**優先理由**: この流れがなければユーザーはクイズに到達できないため最優先。

**単体テスト**: トップページを表示し、開始ボタンをクリックし、出題画面に手牌と解答用コントロールが表示されることを確認すれば価値を検証できる。

**受入シナリオ**:

1. **Given** ユーザーがトップページにいる, **When** 出題開始用ボタンをクリックする, **Then** 出題画面が表示される
2. **Given** 出題画面の読み込み中, **When** データが届く, **Then** 手牌が牌画像として指定順（萬子・索子・筒子・字牌：東南西北白發中）で表示される
3. **Given** 出題画面が表示されている, **When** ユーザーが解答エリアを確認する, **Then** 全種類の牌が選択可能で、複数牌を選択できる

---

### ユーザーストーリー2 - 解答を送信して結果を見る (優先度: P2)

ユーザーは解答として1枚以上の牌を選択済みである。「解答する」ボタンをクリックする。システムは選択内容と正解（アガリ牌）を比較し、一致すれば正解、そうでなければ不正解のモーダルを表示する。

**優先理由**: 解答してフィードバックを得られることが中核価値であり、P1に依存する。

**単体テスト**: P1を完了した状態で牌を選択し、送信をクリックし、一致可否に応じて正解または不正解モーダルが表示されることを確認すれば検証できる。

**受入シナリオ**:

1. **Given** ユーザーが正解と一致する牌を選択している, **When** 「解答する」をクリックする, **Then** 正解を示すモーダルが表示される
2. **Given** ユーザーが正解と一致しない牌を選択している, **When** 「解答する」をクリックする, **Then** 不正解を示すモーダルが表示される
3. **Given** 結果モーダルが表示されている, **When** ユーザーがモーダルを閉じる, **Then** 出題画面に留まり、同じ問題をやり直すか、戻るボタンでトップページへ戻れる

---

### エッジケース

- バックエンドがデータを返さない、またはエラーを返した場合：エラーメッセージを表示し、リトライ（再取得）ボタンとトップへ戻る操作の両方を用意する。真っ白・壊れた画面のままにしない。
- ユーザーが1枚も選択せずに送信した場合：1枚以上選択するまで「解答する」ボタンは押せない（無効化）とする。
- 牌コードに対応する画像ファイルが存在しない場合：該当牌のみエラー表示（例: 画像枠＋「読み込み失敗」）とし、他の牌は表示してクイズは続行可能とする。

## 要件 *(必須)*

### 機能要件

- **FR-001**: システムは、出題画面へ遷移または開くための単一の操作（例: ボタン）をトップページに用意しなければならない。
- **FR-002**: システムは、バックエンドから出題データ（手牌と正解）を取得し、手牌を牌画像として表示しなければならない。取得失敗時はエラーメッセージを表示し、リトライ（再取得）とトップへ戻るの両方の操作を用意しなければならない。
- **FR-003**: 牌画像は牌コード（例: tiles 配列の要素）と対応づけなければならない。各コードは画像（例: 所定の画像セット内のファイル名と一致）に対応しなければならない。画像が存在しない牌は該当箇所のみエラー表示（例: 画像枠＋「読み込み失敗」）とし、他は表示して続行可能とする。
- **FR-004**: 手牌は次の固定順で表示しなければならない。萬子、索子、筒子、字牌（東・南・西・北・白・發・中の順）。
- **FR-005**: システムは、ユーザーが全種類の牌を確認し、複数牌を解答として選択できる解答エリアを用意しなければならない。
- **FR-005a**: 1枚以上牌が選択されていないときは「解答する」を無効にし、押せない状態にしなければならない。
- **FR-006**: システムは「解答する」操作を用意し、実行時にユーザーの選択と正解（アガリ牌）を比較しなければならない。
- **FR-007**: 選択が正解と完全に一致する場合、システムは正解を示すモーダルを表示しなければならない。
- **FR-008**: 選択が正解と一致しない場合、システムは不正解を示すモーダルを表示しなければならない。
- **FR-009**: 結果モーダルを閉じた後は出題画面に留まり、ユーザーは同じ問題をやり直すか、戻る操作でトップページへ戻れるようにしなければならない。

### 主要エンティティ

- **出題 / 1局**: 1回分のクイズ。手牌（牌）と正解（アガリ牌）を含む。
- **手牌（牌）**: 表示する手牌を表す牌コードの並び。萬・索・筒・字の順で画像として表示する。
- **アガリ牌**: 当該出題の正解を構成する牌コードの集合。
- **ユーザー解答**: ユーザーが選択した牌の集合。アガリ牌と比較して正誤を判定する。

## 成功基準 *(必須)*

### 測定可能なアウトカム

- **SC-001**: ユーザーがトップページから出題画面へ進み、手牌と解答エリアを一連の明確な流れで確認できる。
- **SC-002**: ユーザーが1サイクル（出題開始 → 手牌表示 → 解答選択 → 送信 → 正解/不正解の表示）を、その流れから離れずに完了できる。
- **SC-003**: 正解と不正解が明確に区別できる（例: モーダルで正解/不正解を表示）。
- **SC-004**: 手牌は常に指定順（萬子・索子・筒子・字牌）で表示され、ユーザーが一貫して手牌を読める。

## 前提条件

- バックエンドは、手牌の tiles 配列と正解の winningTiles を含む出題データを返す API を既に提供している。
- API の牌コードは、所定の画像セット（例: public/images/tiles のようなパス）の画像ファイル名と対応している。
- 正解の「一致」は、ユーザーの選択集合がアガリ牌の集合と等しい（同じ牌で過不足なし）ことを意味する。選択の順序は実装方針により考慮するかどうかを決める。
- 1画面につき1問とする。本機能では複数問の連続フローは要求しない。
