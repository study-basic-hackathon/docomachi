# Data Model: 001-simple-frontend

**Feature**: 一問フロントエンド（麻雀手牌クイズ）  
**Date**: 2025-02-28

本機能はフロントエンドのみ追加する。永続化は行わず、既存バックエンドの **MahjongHand** から1件取得して表示・解答判定に用いる。以下はフロントで扱うデータ形状と状態の整理。

---

## 既存バックエンドエンティティ（参照）

### MahjongHand（Amplify Data / AppSync）

| 属性 | 型 | 説明 |
|------|-----|------|
| id | ID (string) | 手牌レコードの一意識別子 |
| tiles | string[] | 手牌 13 枚の牌コード配列 |
| winningTiles | string[] | 正解（アガリ牌）の牌コード配列 |
| createdAt | AWSDateTime | 作成日時（クライアントで表示必須でなければ未使用可） |
| updatedAt | AWSDateTime | 更新日時（同上） |

- 牌コードは `src/lib/mahjong/mahjongHand.ts` の `TileCode` 型と一致（例: `1m`〜`9m`, `1p`〜`9p`, `1s`〜`9s`, `ton`, `nan`, `sha`, `pe`, `haku`, `hatsu`, `chun`）。
- 表示順: 萬子 → 索子 → 筒子 → 字牌（東南西北白發中）。API の並びはそのまま使わず、フロントでソートして表示する。

---

## フロントエンドで扱うデータ（本機能）

### 出題（1問）

| フィールド | 型 | 説明 |
|------------|-----|------|
| id | string | MahjongHand.id をそのまま使用 |
| tiles | TileCode[] | 手牌 13 枚（表示用にソート済みを推奨） |
| winningTiles | TileCode[] | 正解の牌コード集合（比較時は集合として扱う） |

- バックエンドから取得した1件をそのまま「出題」として保持する。
- 取得失敗時はエラー状態を保持し、リトライ or トップへ戻る UI を表示する。

### ユーザー解答（画面状態）

| 概念 | 型 | 説明 |
|------|-----|------|
| selectedTiles | TileCode[] または Set<TileCode> | ユーザーが選択した牌の集合。順序は正解判定に不要。 |

- **正解判定**: `selectedTiles` と `winningTiles` を集合として比較し、要素が完全に一致すれば正解、そうでなければ不正解（仕様・clarify 済み）。

### 画面状態（UI 状態）

| 状態 | 説明 |
|------|------|
| idle | 出題取得前（トップ or 出題画面でロード前） |
| loading | 出題取得中 |
| error | 取得失敗（リトライ・トップへ戻るを表示） |
| ready | 出題表示・解答選択中 |
| submitted | 解答送信済み・結果モーダル表示中 |

- 1枚も選択していないときは「解答する」を無効化（FR-005a）。
- 結果モーダル閉じ後は `ready` に戻し、同じ問題でやり直し or 戻るボタンでトップへ。

---

## バリデーション

- **tiles**: 長さ 13、各要素は `TileCode` のいずれか（既存 `src/lib/mahjong/validation.ts` を利用可）。
- **winningTiles**: 各要素は `TileCode`。枚数は仕様で固定していない（1〜複数）。
- 画像: 牌コードと `public/images/tiles/{code}.gif` の対応。欠損時は該当牌のみエラー表示とし、他は表示継続（FR-003 clarify 済み）。

---

## ライフサイクル

1. トップ → スタート → 出題画面へ遷移。
2. 出題画面で listMahjongHands（または相当 API）を呼び、1件を選んで `出題` をセット → `ready`。
3. ユーザーが牌を選択 → `selectedTiles` 更新。1枚以上で「解答する」有効。
4. 「解答する」クリック → フロントで正誤判定 → 正解/不正解モーダル表示（`submitted`）。
5. モーダル閉じる → `ready` に戻す（選択クリアしてやり直し可能）。戻るボタンでトップへ。
6. 取得エラー時は `error`。リトライで再取得、トップへ戻るでトップに遷移。
