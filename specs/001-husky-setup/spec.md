# Feature Specification: Huskyセットアップとコミット前テスト実行

**Feature Branch**: `001-husky-setup`  
**Created**: 2026-02-17  
**Status**: Draft  
**Input**: User description: "huskyをセットアップしてください。コミット前にJestのテストが実行されるようにしてください。"

## User Scenarios & Testing *(mandatory)*

### User Story 1 - コミット前の自動テスト実行 (Priority: P1)

開発者がGitコミットを実行しようとした際に、huskyがpre-commitフックを自動的に実行し、Jestテストを実行する。すべてのテストが成功した場合のみコミットが完了し、テストが失敗した場合はコミットがブロックされ、エラーメッセージが表示される。

**Why this priority**: コード品質を保証し、テストが失敗するコードがリポジトリにコミットされることを防ぐための基盤機能。開発フローの自動化において最も重要な機能。

**Independent Test**: 開発者がコミットを試み、テストが自動実行され、成功時はコミットが完了し、失敗時はコミットがブロックされることを確認できる。これにより、テストが失敗するコードがコミットされることを防ぐという価値を提供する。

**Acceptance Scenarios**:

1. **Given** huskyがセットアップされている状態で、**When** 開発者が`git commit`を実行する、**Then** pre-commitフックが自動的に実行され、Jestテストが実行される
2. **Given** すべてのJestテストが成功している状態で、**When** 開発者が`git commit`を実行する、**Then** コミットが正常に完了する
3. **Given** 1つ以上のJestテストが失敗している状態で、**When** 開発者が`git commit`を実行する、**Then** コミットがブロックされ、テスト失敗の詳細が表示される
4. **Given** huskyがセットアップされている状態で、**When** 開発者が`git commit --no-verify`を実行する、**Then** フックをスキップしてコミットが実行される（既存のGit機能）

### Edge Cases

- テスト実行中にタイムアウトが発生した場合、コミットはブロックされる
- テストファイルが存在しない場合、エラーなくコミットが完了する（テストが実行されない）
- 複数の開発者が同じリポジトリをクローンした場合、huskyのセットアップが自動的に適用される
- テスト実行に時間がかかる場合、開発者に進行状況が表示される

## Requirements *(mandatory)*

### Functional Requirements

- **FR-001**: システムはhuskyをインストールし、Gitフックを管理できるようにする必要がある
- **FR-002**: システムはpre-commitフックを設定し、コミット前に自動的に実行されるようにする必要がある
- **FR-003**: システムはpre-commitフック実行時に、プロジェクト内のJestテストを自動実行する必要がある
- **FR-004**: システムはすべてのテストが成功した場合のみ、コミットを許可する必要がある
- **FR-005**: システムはテストが失敗した場合、コミットをブロックし、失敗したテストの詳細を表示する必要がある
- **FR-006**: システムはhuskyのセットアップを再現可能にし、新しい開発者がリポジトリをクローンした際に自動的にセットアップが適用されるようにする必要がある

## Success Criteria *(mandatory)*

### Measurable Outcomes

- **SC-001**: 開発者がコミットを実行する際、100%の確率でpre-commitフックが自動実行され、Jestテストが実行される
- **SC-002**: テストが失敗している状態でのコミット試行は、100%の確率でブロックされる
- **SC-003**: テストが成功している状態でのコミットは、通常のコミット時間に加えてテスト実行時間（通常30秒以内）で完了する
- **SC-004**: 新しい開発者がリポジトリをクローンし、依存関係をインストールした後、追加の手動セットアップなしでhuskyが機能する
- **SC-005**: テスト失敗時のエラーメッセージは、開発者が問題を特定できる十分な情報（失敗したテスト名、エラー内容）を含む
