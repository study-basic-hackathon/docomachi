# Feature Specification: バックエンドの構築

**Feature Branch**: `002-amplify-backend-setup`  
**Created**: 2025-02-20  
**Status**: Draft  
**Input**: User description: "バックエンドの構築。プロジェクトをAWS Amplify Gen2にしてください。AWS Amplifyのデフォルトの認証機能を実装してください。DynamoDBでdocomachiテーブルを作成してください。パーティションキーはUUIDにしてください。デプロイはせず、コードの実装のみとしてください。"

## Clarifications

### Session 2025-02-20

- Q: 実装完了の定義に「プルリクエストの作成」を含めるか。マージ後のAWSコンソール設定は本機能の範囲外でよいか。 → A: 完了定義に「PR の作成」を含める。マージ後の AWS コンソール設定は依頼者側の作業とし、本機能の範囲外とする。
- Q: docomachi テーブルで、現時点でパーティションキー（UUID）以外に定義すべき属性はあるか。 → A: 本機能ではパーティションキー（UUID）のみ定義する。他の属性は後続のデータ要件で追加する。
- Q: バックエンドの定義で利用する AWS リージョンはどうするか。 → A: 本機能ではリージョンを指定しない。Amplify のデフォルト、または依頼者がマージ後にコンソールで設定する。

## User Scenarios & Testing *(mandatory)*

### User Story 1 - バックエンド基盤の用意 (Priority: P1)

開発者が、アプリケーションのバックエンドを一貫した構成で用意できる。クラウドベースのバックエンド基盤がコードとして定義され、認証やデータストアを追加する土台となる。

**Why this priority**: 基盤がないと認証やデータ永続化を追加できないため、最優先。

**Independent Test**: リポジトリ内にバックエンド用の定義が存在し、ビルドや検証がローカルで実行できることで確認できる。

**Acceptance Scenarios**:

1. **Given** プロジェクトリポジトリがある, **When** バックエンド構築が完了している, **Then** 指定されたクラウドバックエンド用の設定・コードがリポジトリに含まれる
2. **Given** バックエンド用の設定がある, **When** 開発者がローカルでビルド・検証する, **Then** エラーなく完了する（デプロイは行わない）

---

### User Story 2 - 認証機能の利用準備 (Priority: P2)

開発者が、アプリで「サインアップ・サインイン」などの認証を利用できるようにする。デフォルトの認証機能がコードで有効化され、後の実装で利用可能になる。

**Why this priority**: 多くの機能が認証済みユーザーを前提とするため、基盤の次に重要。

**Independent Test**: 認証に関する設定・リソース定義がコードに含まれており、仕様に沿っていることで確認できる。

**Acceptance Scenarios**:

1. **Given** バックエンド基盤が用意されている, **When** 認証機能を実装する, **Then** デフォルトの認証（サインアップ・サインイン等）が有効になる定義が含まれる
2. **Given** 認証の定義がある, **When** 実装範囲を確認する, **Then** デプロイは行わず、コードの追加・変更のみの範囲である

---

### User Story 3 - アプリ用データストアの定義 (Priority: P3)

開発者が、アプリの主要データを一意のIDで保存・取得できる永続ストアを用意できる。docomachi 用のテーブルが定義され、各レコードを一意に識別するキーで管理できる。

**Why this priority**: 認証の後に、アプリ固有データを扱うために必要。

**Independent Test**: docomachi 用のテーブル定義が存在し、パーティションキーが一意識別子（UUID）であることで確認できる。

**Acceptance Scenarios**:

1. **Given** バックエンドが用意されている, **When** データストアを確認する, **Then** docomachi 用のテーブルが定義されている
2. **Given** docomachi テーブルの定義がある, **When** キー設計を確認する, **Then** パーティションキーが UUID として定義されている

---

### Edge Cases

- 既存のバックエンド設定やブランチがある場合、新規の定義が既存と衝突しないかどうか（上書き・マージ方針は実装フェーズで扱う）
- リージョンは本機能では指定しない。Amplify のデフォルト、または依頼者がマージ後に AWS コンソールで設定する想定である。
- テーブル名やキー名が環境や規約と整合しているか（命名規則は Assumptions で明示）

## Requirements *(mandatory)*

### Functional Requirements

- **FR-001**: システムは、指定されたクラウドバックエンド向けの設定とコードをリポジトリに含め、デプロイは行わず実装のみで完了する形で提供すること。
- **FR-002**: システムは、サインアップ・サインイン等を可能にするデフォルトの認証機能を、コードで有効化できる形で用意すること。
- **FR-003**: システムは、アプリ用の永続データを格納する docomachi 用テーブルを定義し、パーティションキーを UUID とすること。
- **FR-004**: バックエンドの変更は、コードの追加・更新で表現され、本機能の範囲ではデプロイやインフラの手動操作を含まないこと。
- **FR-005**: 用意した定義・コードは、ローカルでのビルドや検証が可能であること。
- **FR-006**: 実装完了時には、変更をレビュー可能な形で提出するため、プルリクエストを作成すること。マージ後の AWS コンソール上での設定は依頼者側が行い、本機能の成果物・作業範囲外とする。

### Key Entities

- **バックエンド基盤**: クラウド上のアプリ用バックエンド。認証とデータストアの土台となる設定・コードで表現される。
- **認証**: ユーザーのサインアップ・サインイン等を扱う機能。デフォルトの認証機能としてコードで有効化される。
- **docomachi テーブル**: アプリの主要データを格納する永続ストアの論理名。本機能ではパーティションキー（UUID）のみ定義し、各レコードは一意に識別される。他の属性は後続のデータ要件で追加する。

## Assumptions

- バックエンドは、入力で指定された「AWS Amplify Gen2」および「DynamoDB」を用いた構成で実装する。
- 認証は、Amplify のデフォルト認証（メール/パスワード等）を想定する。多要素認証や外部 IdP の詳細は本仕様の範囲外とする。
- 「デプロイはせずコードの実装のみ」とは、本機能で作成・更新するのはリポジトリ内のコード・設定のみとし、クラウドへのデプロイやコンソールでのリソース作成は行わないことを意味する。完了時にはプルリクエストを作成する。
- マージ後の AWS コンソール上での設定（リソース作成・デプロイ・リージョン指定等）は依頼者側が実施し、本機能の範囲外とする。本機能のコードではリージョンを指定しない。
- テーブル名は docomachi、パーティションキーは UUID とする。本機能ではパーティションキーのみ定義し、ソートキー・GSI・その他の属性は後続のデータ要件で追加する。

## Success Criteria *(mandatory)*

### Measurable Outcomes

- **SC-001**: 開発者がリポジトリを取得したうえで、バックエンド関連のコード・設定をローカルでビルド・検証し、デプロイなしで完了できる。
- **SC-002**: 認証を有効にするための定義がコードに含まれており、仕様書またはコメントから「デフォルト認証」の範囲が分かる。
- **SC-003**: docomachi 用のテーブルが定義され、パーティションキーが UUID であることが、定義ファイルまたはドキュメントから確認できる。
- **SC-004**: 本機能の成果物はすべてコードで表現され、デプロイ手順や手動のインフラ操作は成果物に含まれない。
- **SC-005**: 実装完了時点で、変更内容を提出するためのプルリクエストが作成されていること。マージ後の AWS コンソール設定は依頼者側の作業であり、本機能の受け入れ条件には含めない。
